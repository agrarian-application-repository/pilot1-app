services:
  # 1. MediaMTX Server
  mediamtx:
    image: bluenviron/mediamtx:latest
    container_name: mediamtx
    volumes:
      - ./configs/mediamtx/my_mediamtx.yaml:/mediamtx.yml:ro # Pass your config file as read-only
    ports:
      - "8554:8554" # RTSP
      - "1935:1935" # RTMP
      - "8888:8888" # HLS
      - "8889:8889" # WebRTC
    restart: unless-stopped

  # 2. Mosquitto MQTT Server
  mosquitto:
    image: eclipse-mosquitto:latest
    container_name: mosquitto
    volumes:
      - ./configs/mosquitto/mosquitto.conf:/mosquitto/config/mosquitto.conf:ro
      - ./certificates/mosquitto/ca.crt:/mosquitto/config/ca.crt:ro
      - ./certificates/mosquitto/mosquitto.crt:/mosquitto/config/mosquitto.crt:ro
      - ./certificates/mosquitto/mosquitto.key:/mosquitto/config/mosquitto.key:ro
      - ./data/mosquitto:/mosquitto/data
      - ./logs/mosquitto:/mosquitto/log
    ports:
      - "1883:1883"
      - "8883:8883"
      - "9001:9001"
    restart: unless-stopped

  # 3. Your Custom Application
  my-app:
    image: your-app-image:latest # Replace with your actual image name
    container_name: my_application
    ports:
      - "443:443"
    environment:
      - APP_USER=admin
      - APP_PASSWORD=secretpassword
      - DATABASE_URL=postgres://user:pass@db:5432/dbname
    volumes:
      - ./app_data/config_file_1.json:/app/config_file_1.json
      - ./app_data/config_file_2.json:/app/config_file_2.json
      - app_uploads:/app/uploads
    depends_on:
      - mediamtx
      - mosquitto
    restart: unless-stopped

volumes:
  mosquitto_data:
  mosquitto_log:
  app_uploads: